<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />

  <title>Refine2Web</title>
  <meta content="" name="description" />
  <meta content="" name="keywords" />

  <!-- Favicons -->
  <link href="/img/favicon.ico" type="image/x-icon" rel="icon" />

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect" />
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet" />

  <!-- Boxicons CDN Link -->
  <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />

  <!-- Bootsrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css" />
  <!-- Animate CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <!-- Bootstrap core JS-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <!--Adding jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.1.min.js"
    integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />
  <!-- Template Main CSS File -->
  <link href="/css/style.css" rel="stylesheet" />

  <!-- =======================================================
  
    ======================================================== -->

</head>

<body class="toggle-sidebar" style="overflow: hidden; " onload="setInitalCondition();getAlarmState();showLastCross()">

  <!--#region ======= Setting ======= -->
  <div class="popup">
    <div class="container h-100">
      <i class="bi bi-x-circle option-close"></i>
      <div class="h-100">
        <!--=== Settings title ===-->
        <div class="row h-10">
          <h2>Setting</h2>
        </div>
        <!--=== Settings title ===-->

        <!--=== Settings body ===-->

        <!--=== Alarm Toggle ===-->
        <div class="row h-10">
          <div class="col">
            <p style="display: flex!important; align-items: center; justify-content: center; height: 100%;">Alarm:</p>
          </div>

          <div class="col">
            <label class="switch">
              <input class="cb" type="checkbox" id="alarmChecbox" onclick="update_Alarm(this.id)" />
              <span class="slider round"></span>
            </label>
          </div>
        </div>
        <!--=== Alarm Toggle ===-->

        <!--=== Digital Signal Toggle ===-->
        <div class="row h-10">
          <div class="col">
            <p style="display: flex!important; align-items: center; justify-content: center; height: 100%;">COM Signal:
            </p>
          </div>
          <div class="col">
            <label class="switch">
              <input class="cb" type="checkbox" id="digitalChecbox" onclick="update_COMState(this.id)" />
              <span class="slider round"></span>
            </label>
          </div>
        </div>
        <!--=== Digital Signal Toggle ===-->

        <!--=== GitHub Btn ===-->
        <div class="row h-10 gitBtn-pos">
          <div class="col w-10">
            <a role="button" target="_blank" href="https://github.com/Fillodallas/OpenIce2Web"
              class="btn fs-mini settings-btn github-btn">
              <i class="bx bxl-github"></i>
              GitHub
            </a>
          </div>
        </div>
        <!--=== GitHub Btn ===-->

        <!--=== Settings body ===-->
      </div>
    </div>
  </div>
  <!--#endregion ======= End Setting ====== -->

  <!--#region ======= Sidebar ======= -->
  <div class="sidebar">
    <div class="logo-details">
      <img class="icon" alt="website logo" src="/img/logo.png" width="25" height="25" />
      <div class="logo_name">Refine2Web</div>
      <i class="bx bx-menu" id="btn"></i>
    </div>
    <ul class="nav-list">
      <li>
        <i class="bx bx-search"></i>
        <input type="text" placeholder="Search..." name="" />

        <span class="tooltip">Search</span>
      </li>
      <li>
        <a href="/">
          <i class="bx bx-grid-alt"></i>
          <span class="links_name">Dashboard</span>
        </a>
        <span class="tooltip">Dashboard</span>
      </li>
      <li>
        <a href="/monitor">
          <i class="bx bx-tv"></i>
          <span class="links_name">Monitor</span>
        </a>
        <span class="tooltip">Monitor</span>
      </li>
      <li>
        <a href="/parameters">
          <i class="bx bx-pie-chart-alt-2"></i>
          <span class="links_name">Parameters</span>
        </a>
        <span class="tooltip">Parameters</span>
      </li>

      <li class="profile">
        <a href="#" id="show-login">
          <i class="bx bx-cog"></i>
          <span class="links_name">Setting</span>
        </a>
        <span class="tooltip">Setting</span>
      </li>
    </ul>
  </div>
  <!--#endregion ======= End Sidebar ======= -->

  <!-- Page Content-->
  <main id="main" class="main" style="margin-top: 5px;">
    <!-- Page Title -->
    <div class="pagetitle">
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Home</a></li>
          <li class="breadcrumb-item active">Parameters</li>
        </ol>
      </nav>
    </div>
    <!-- End Page Title -->

    <div class="row">
      <!--#region Column Sliders-->
      <div class="col-xxl-4 col-md-6">
        <div class="row">
          <!--#region SpO2 Safety Limits-->
          <div class="wrapper-SpO2">
            <header>
              <h2>SpO2 Safety Limits</h2>

            </header>
            <div class="value-input">
              <div class="field">
                <span class="labels">Min</span>
                <input type="number" class="input-min" value="82">
              </div>
              <div class="separator">-</div>
              <div class="field">
                <span class="labels">Max</span>
                <input type="number" class="input-max" value="90">
              </div>
            </div>
            <div class="slider-SPO2">

              <div class="postprogress"></div>
              <div class="preprogress"></div>
              <div class="progress"></div>
            </div>
            <div class="range-input">
              <input type="range" class="range-min" min="0" max="100" value="82" step="2">
              <input type="range" class="range-max" min="0" max="100" value="90" step="2">
            </div>

            <div class="btn-holder">
              <button type="button" class="btn btn-success"
                onclick="updateVal_SpO2();tempText('updateSpO2')">Save</button>
              <p id="updateSpO2" class="animate__animated animate__faster"><i class='bx bx-check'></i> Values updated
              </p>
            </div>
          </div>
          <!--#endregion SpO2 Safety Limits-->
        </div>
        <div class="row">
          <!--#region RR Safety Limits-->
          <div class="wrapper-RR">
            <header>
              <h2>RR Safety Limits</h2>

            </header>
            <div class="value-input">
              <div class="field">
                <span class="labels">Lowest</span>
                <input type="number" class="input-lowest" value="4">
              </div>
              <div class="separator">-</div>
              <div class="field">
                <span class="labels">Lower</span>
                <input type="number" class="input-lower" value="10">
              </div>
              <div class="separator">-</div>
              <div class="field">
                <span class="labels">Higher</span>
                <input type="number" class="input-higher" value="25">
              </div>
              <div class="separator">-</div>
              <div class="field">
                <span class="labels">Highest</span>
                <input type="number" class="input-highest" value="35">
              </div>
            </div>
            <div class="slider-RR">

              <div class="redLow"></div>
              <div class="yelLow"></div>
              <div class="greenCenter"></div>
              <div class="yelHigh"></div>
              <div class="redHigh"></div>
            </div>
            <div class="range-input">
              <input type="range" class="range-lowest" min="0" max="40" value="4" step="2">
              <input type="range" class="range-lower" min="0" max="40" value="10" step="2">
              <input type="range" class="range-higher" min="0" max="40" value="25" step="2">
              <input type="range" class="range-highest" min="0" max="40" value="35" step="2">
            </div>

            <div class="btn-holder">
              <button type="button" class="btn btn-success" onclick="updateVal_RR();tempText('updateRR')">Save</button>
              <p id="updateRR" class="animate__animated animate__faster"><i class='bx bx-check'></i> Values updated</p>
            </div>
          </div>
          <!--#endregion RR Safety Limits-->
        </div>
      </div>
      <!--#endregion Column Sliders-->

      <!--#region Column Table-->
      <div class="col-xxl-4 col-md-6" style="margin: 10px;">
        <div class="card">

          <div class="card-body"
            style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
            <div class="d-flex align-items-center">
              <div style="margin-top: 20px">
                <table class="zui-table">
                  <thead>
                    <tr>
                      <th>Parameter</th>
                      <th>Value</th>
                      <th>Time</th>
                      <th>Code</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Respiratory Rate</td>
                      <td id="RRlim_val">- -</td>
                      <td id="RRlim_tim">- -</td>
                      <td id="RRlim_code">- -</td>
                    </tr>
                    <tr>
                      <td>SpO2</td>
                      <td id="SpO2lim_val">- -</td>
                      <td id="SpO2lim_tim">- -</td>
                      <td id="SpO2lim_code">- -</td>
                    </tr>
                  </tbody>
                </table>
              </div>

            </div>
          </div>


        </div>
      </div>
      <!--#endregion Column Table-->
    </div>

  </main>

  <!-- Scripts -->
  <script>
    var exports = {};
  </script>
  <script src="js/main.js"></script>
  <script src="js/functions.js"></script>
  <script src="config/safetyParam.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
  <!-- Socket Connection-->
  <script src="/socket.io/socket.io.js"></script>

  <script type="text/javascript">

    var HOST = self.location.host;
    var socket = io(HOST);

    //#region Sezione ricezione e sroting dati
    socket.on("data", function (data) {
      //listen for an event called data, when data event happens it runs this function

      msg = data.toString();
      var arr = msg.split(":");

      //#region Data distribution
      switch (arr[0]) {
        //#region Single data sorting

        case "MDC_CO2_RESP_RATE": // RR

          saveLimRR(arr[1], localStorage.getItem("RR_Lowest"), localStorage.getItem("RR_Lower"), localStorage.getItem("RR_Higer"), localStorage.getItem("RR_Highest"))
          if (localStorage.getItem("RR_Lim") != null) RR_Lim = localStorage.getItem("RR_Lim").split(",")
          document.getElementById("RRlim_val").innerHTML = RR_Lim[0];
          document.getElementById("RRlim_tim").innerHTML = RR_Lim[1];
          document.getElementById("RRlim_code").innerHTML = RR_Lim[2];

          break;


        case "MDC_PULS_OXIM_SAT_O2": // PO2%
          saveLimSpO2(arr[1], localStorage.getItem("SPo2_Min"), localStorage.getItem("SPo2_Max"))
          if (localStorage.getItem("SpO2_Lim") != null) SpO2_Lim = localStorage.getItem("SpO2_Lim").split(",");

          document.getElementById("SpO2lim_val").innerHTML = SpO2_Lim[0];
          document.getElementById("SpO2lim_tim").innerHTML = SpO2_Lim[1];
          document.getElementById("SpO2lim_code").innerHTML = SpO2_Lim[2];

          break;


        //#endregion Single data sorting
      }
      //#endregion Data distribution
    });


    //#endregion Sezione ricezione dati

    //#region Function Section


    var SPo2_Max, SPo2_Min;
    var RR_Lowest, RR_Lower, RR_Higer, RR_Highest;

    // Setto il range inizale prendendo i parametri dal file Json, dopo faccio che se non ho valori salvati nella memoria locale prendo questi!
    function setInitalCondition() {

      //#region setInitalCondition SpO2
      if ((localStorage.getItem("SPo2_Min") == null) || (localStorage.getItem("SPo2_Max") == null)) {
        // Se uno dei due valori non è salvato in memoria locale inizializzo l'input utilizzanod valori slavati in safetyParam (SpO2min, SpO2max)
        rangeInput_SpO2[0].value = SpO2min;
        rangeInput_SpO2[1].value = SpO2max;

      } else {

        // Se ci sono entrambi setto il valore che trovo nel local storage 
        rangeInput_SpO2[0].value = localStorage.getItem("SPo2_Min");
        rangeInput_SpO2[1].value = localStorage.getItem("SPo2_Max");
      }
      //#endregion setInitalCondition SpO2

      //#region setInitalCondition RR
      if ((localStorage.getItem("RR_Highest") == null) || (localStorage.getItem("RR_Higer") == null) || (localStorage.getItem("RR_Lower") == null) || (localStorage.getItem("RR_Lowest") == null)) {
        // Se uno dei due valori non è salvato in memoria locale inizializzo l'input utilizzanod valori slavati in safetyParam (SpO2min, SpO2max)
        rangeInput_RR[0].value = RR_Lowest;
        rangeInput_RR[1].value = RR_Lower;
        rangeInput_RR[2].value = RR_Higer;
        rangeInput_RR[3].value = RR_Highest;

      } else {

        // Se ci sono entrambi setto il valore che trovo nel local storage 
        rangeInput_RR[0].value = localStorage.getItem("RR_Lowest");
        rangeInput_RR[1].value = localStorage.getItem("RR_Lower");
        rangeInput_RR[2].value = localStorage.getItem("RR_Higer");
        rangeInput_RR[3].value = localStorage.getItem("RR_Highest");
      }
      //#endregion setInitalCondition RR
      updateBarScroll();
      updateBarScroll_RR();

    }


    //Function for the button
    function updateVal_SpO2() {
      localStorage.setItem("SPo2_Max", SPo2_Max);
      localStorage.setItem("SPo2_Min", SPo2_Min);
    }


    //Function for the button
    function updateVal_RR() {
      localStorage.setItem("RR_Lowest", rangeInput_RR[0].value);
      localStorage.setItem("RR_Lower", rangeInput_RR[1].value);
      localStorage.setItem("RR_Higer", rangeInput_RR[2].value);
      localStorage.setItem("RR_Highest", rangeInput_RR[3].value);
    }


    function checkContainerWidth() {
      $(document).ready(function () {
        var width = $("#main").outerWidth();

        //console.log(width);

        if (width < 536) {
          document.querySelectorAll('span').forEach(e => e.style.display = 'none');
        } else {
          document.querySelectorAll('span').forEach(e => e.style.display = 'block');
        }

      });
    }

    window.addEventListener("resize", function () {
      checkContainerWidth();
    });

    checkContainerWidth(); //first call

    function showLastCross() {
      if (localStorage.getItem("SpO2_Lim") != null) SpO2_Lim = localStorage.getItem("SpO2_Lim").split(",");
      document.getElementById("SpO2lim_val").innerHTML = SpO2_Lim[0];
      document.getElementById("SpO2lim_tim").innerHTML = SpO2_Lim[1];
      document.getElementById("SpO2lim_code").innerHTML = SpO2_Lim[2];

      if (localStorage.getItem("RR_Lim") != null) RR_Lim = localStorage.getItem("RR_Lim").split(",");
      document.getElementById("RRlim_val").innerHTML = RR_Lim[0];
      document.getElementById("RRlim_tim").innerHTML = RR_Lim[1];
      document.getElementById("RRlim_code").innerHTML = RR_Lim[2];
    }
    //#endregion Function Section


  </script>
</body>

</html>